{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/bitjungle/gopca/schemas/v1/model-metadata.schema.json",
  "title": "PCA Model Metadata",
  "description": "Metadata about the PCA model and analysis configuration",
  "type": "object",
  "required": ["analysis_id", "software_version", "created_at", "software", "config"],
  "properties": {
    "analysis_id": {
      "type": "string",
      "description": "Unique identifier for this analysis (UUID)",
      "pattern": "^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$"
    },
    "software_version": {
      "type": "string",
      "description": "GoPCA software version (e.g., '0.9.0', 'dev')",
      "minLength": 1
    },
    "created_at": {
      "type": "string",
      "description": "ISO 8601 timestamp of model creation",
      "format": "date-time"
    },
    "software": {
      "type": "string",
      "description": "Software used to create the model",
      "const": "gopca"
    },
    "data_source": {
      "type": "object",
      "description": "Information about the input data file",
      "properties": {
        "filename": {
          "type": "string",
          "description": "Original data file name"
        },
        "hash": {
          "type": "string",
          "description": "SHA-256 hash of input data",
          "pattern": "^[a-f0-9]{64}$"
        },
        "n_rows_original": {
          "type": "integer",
          "description": "Number of rows before any exclusions",
          "minimum": 0
        },
        "n_cols_original": {
          "type": "integer",
          "description": "Number of columns before any exclusions",
          "minimum": 0
        }
      }
    },
    "description": {
      "type": "string",
      "description": "User-provided description or notes about the analysis"
    },
    "tags": {
      "type": "array",
      "description": "User-defined tags for categorization",
      "items": {
        "type": "string"
      }
    },
    "config": {
      "type": "object",
      "description": "Configuration used for PCA analysis",
      "required": ["method", "n_components"],
      "properties": {
        "method": {
          "$ref": "common.schema.json#/definitions/PCAMethod"
        },
        "n_components": {
          "type": "integer",
          "description": "Number of principal components computed",
          "minimum": 1
        },
        "missing_strategy": {
          "$ref": "common.schema.json#/definitions/MissingValueStrategy"
        },
        "excluded_rows": {
          "type": "array",
          "description": "0-based indices of excluded rows",
          "items": {
            "type": "integer",
            "minimum": 0
          }
        },
        "excluded_columns": {
          "type": "array",
          "description": "0-based indices of excluded columns",
          "items": {
            "type": "integer",
            "minimum": 0
          }
        },
        "kernel_type": {
          "$ref": "common.schema.json#/definitions/KernelType",
          "description": "Kernel type (only for kernel PCA)"
        },
        "kernel_gamma": {
          "type": "number",
          "description": "RBF/Polynomial kernel parameter",
          "minimum": 0
        },
        "kernel_degree": {
          "type": "integer",
          "description": "Polynomial kernel degree",
          "minimum": 1
        },
        "kernel_coef0": {
          "type": "number",
          "description": "Polynomial kernel coefficient"
        }
      }
    }
  }
}